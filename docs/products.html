
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ALPHAGEN COMPANY.LTD</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background-color: #f4f4f4;
    }

    h1 {
      color: #333;
    }

    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 20px;
      padding-right: 200px;
    }

    .filters {
      margin-bottom: 15px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    select, input.search-bar {
      padding: 10px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }

    #productsContainer {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 20px;
    }

    .product-card {
      background: white;
      padding: 15px;
      border: 1px solid #ddd;
      border-radius: 10px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      text-align: center;
      transition: transform 0.3s, box-shadow 0.3s;
    }

    .product-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.15);
    }

    .product-card img {
      width: 100%;
      aspect-ratio: 4 / 3;
      object-fit: cover;
      border-radius: 5px;
      transition: transform 0.3s;
    }

    .product-card img:hover {
      transform: scale(1.1);
    }

    .product-card h3 {
      margin: 10px 0 5px;
      font-size: 18px;
    }

    .product-card p {
      font-size: 14px;
      color: #666;
    }

    .product-card span {
      display: block;
      margin-top: 10px;
      color: green;
      font-weight: bold;
    }

    .icons {
      display: flex;
      gap: 20px;
      position: relative;
    }

    .icon-container {
      position: relative;
      cursor: pointer;
    }

    .icon-count {
      position: absolute;
      top: -10px;
      right: -10px;
      background: red;
      color: white;
      padding: 2px 6px;
      border-radius: 50%;
      font-size: 12px;
    }

    .dropdown {
      display: none;
      position: absolute;
      right: 0;
      top: 30px;
      background: white;
      border: 1px solid #ccc;
      padding: 10px;
      width: 300px;
      max-height: 300px;
      overflow-y: auto;
      z-index: 100;
    }

    .dropdown-item {
      margin-bottom: 8px;
    }

    strong {
      display: block;
      margin-bottom: 10px;
    }

    .hat {
      margin-left: 0px;
      border: none;
      background-color: rgb(246, 248, 249);
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.2); }
    }

    .kat {
      margin-right: 0px;
      border: none;
    }

    .viuu {
      margin-left: 90px;
    }

    .star-offer {
      width: 130px;
      height: 130px;
      background: radial-gradient(circle at center, #ff7300 60%, #e1f108 100%);
      clip-path: polygon(
        50% 0%, 61% 35%, 98% 35%, 
        68% 57%, 79% 91%, 50% 70%, 
        21% 91%, 32% 57%, 2% 35%, 
        39% 35%
      );
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'Arial Black', sans-serif;
      font-size: 18px;
      color: rgb(226, 10, 10);
      cursor: pointer;
      box-shadow: 0 0 15px rgb(255, 94, 0);
      animation: pulseBlast 2s infinite;
      transition: transform 0.3s ease;
    }

    @keyframes pulseBlast {
      0%, 100% {
        transform: scale(1);
        box-shadow: 0 0 15px rgb(236, 37, 37);
      }
      50% {
        transform: scale(1.1);
        box-shadow: 0 0 25px rgb(246, 26, 26);
      }
    }

    .blast-text {
      pointer-events: none;
      text-align: center;
      animation: flickerText 1.5s infinite;
      color: rgb(250, 247, 247);
      padding-bottom: 10px;
    }

    @keyframes flickerText {
      0%, 100% { opacity: 1; }
      45% { opacity: 0.8; }
      55% { opacity: 0.4; }
      60% { opacity: 0.9; }
      75% { opacity: 0.2; }
      85% { opacity: 1; }
    }
  </style>
</head>
<body>
  <div class="top-bar">
    <div>
      <h1>Welcome to our Products page</h1>
      <p>Here you will find products of your choice and taste</p>
    </div>

    <div class="top-actions" style="display: flex; align-items: center; gap: 15px;">
  <div class="icons">
    <div id="favoriteIcon" class="icon-container">‚ù§Ô∏è
      <div id="favoriteDropdown" class="dropdown">
        <strong>Liked</strong>
        <div id="favoriteItems"></div>
      </div>
    </div>
    <div id="cartIcon" class="icon-container">üõí
      <span id="cartCount" class="icon-count">0</span>
      <div id="cartDropdown" class="dropdown">
        <strong>Cart</strong>
        <div id="cartItems"></div>
        <div style="margin-top: 10px;">
          <strong>Total: Ksh <span id="cartTotal">0</span></strong>
        </div>
      </div>
    </div>
  </div>

  <div id="offersIcon" class="star-offer" title="Offers">
    <span class="blast-text">Offers</span>
  </div>
</div>

  <div class="filters">
    <input class="search-bar" type="text" id="searchInput" placeholder="Search...">
    <select id="categoryFilter">
      <option value="">All Categories</option>
    </select>
    <select id="brandFilter">
      <option value="">All Brands</option>
    </select>
  </div>

  <main>
    <div id="productsContainer" aria-live="polite"></div>
  </main>

  <script>
    const cart = JSON.parse(localStorage.getItem("cart")) || [];
    const favorites = new Set(JSON.parse(localStorage.getItem("favorites")) || []);
    let products = [];

    document.getElementById("cartIcon").addEventListener("click", () => {
      const dropdown = document.getElementById("cartDropdown");
      dropdown.style.display = dropdown.style.display === "block" ? "none" : "block";
    });

    document.getElementById("favoriteIcon").addEventListener("click", () => {
      const dropdown = document.getElementById("favoriteDropdown");
      dropdown.style.display = dropdown.style.display === "block" ? "none" : "block";
    });

    document.getElementById("offersIcon").addEventListener("click", () => {
      window.location.href = "offer.html";
    });

    function addToCart(productId) {
      const product = products.find(p => p.id === productId);
      if (!product) return;
      const existing = cart.find(p => p.id === productId);
      if (existing) {
        existing.quantity += 1;
      } else {
        cart.push({ ...product, quantity: 1 });
      }
      localStorage.setItem("cart", JSON.stringify(cart));
      updateCartUI();
    }

    function toggleFavorite(productId) {
      if (favorites.has(productId)) {
        favorites.delete(productId);
      } else {
        favorites.add(productId);
      }
      localStorage.setItem("favorites", JSON.stringify([...favorites]));
      updateFavoriteUI();
    }

    function updateCartUI() {
      const cartCount = document.getElementById("cartCount");
      const cartItemsContainer = document.getElementById("cartItems");
      const cartTotalEl = document.getElementById("cartTotal");
      let totalItems = 0;
      let totalPrice = 0;
      cartItemsContainer.innerHTML = "";
      cart.forEach((item, index) => {
        const itemTotal = item.quantity * item.price;
        totalItems += item.quantity;
        totalPrice += itemTotal;
        const div = document.createElement("div");
        div.className = "dropdown-item";
        div.textContent = `${index + 1}. ${item.name} x${item.quantity} - $${itemTotal.toFixed(2)}`;
        cartItemsContainer.appendChild(div);
      });
      cartCount.textContent = totalItems;
      cartTotalEl.textContent = totalPrice.toFixed(2);
    }

    function updateFavoriteUI() {
      const container = document.getElementById("favoriteItems");
      container.innerHTML = "";
      let i = 1;
      favorites.forEach(id => {
        const product = products.find(p => p.id === id);
        if (product) {
          const div = document.createElement("div");
          div.className = "dropdown-item";
          div.textContent = `${i++}. ${product.name}`;
          container.appendChild(div);
        }
      });
    }

    window.addEventListener("DOMContentLoaded", async () => {
      speakIntro();
      await fetchProducts();
      setupFilters();
      updateCartUI();
      updateFavoriteUI();
    });

    function speakIntro() {
      const message = "Welcome to our products page. We have all kinds of electronics and electricals you are in need of, all brands of your taste. Scroll down or search in the search bar for a specific product.";
      if (speechSynthesis.speaking) speechSynthesis.cancel();
      const speech = new SpeechSynthesisUtterance(message);
      speechSynthesis.speak(speech);
    }

    window.addEventListener("beforeunload", () => {
      if (speechSynthesis.speaking) speechSynthesis.cancel();
    });

    async function fetchProducts() {
      try {
        const res = await fetch("https://heyz-electricals-and-electronis-website-2.onrender.com/api/products");
        if (!res.ok) throw new Error(`Failed to fetch: ${res.status}`);
        products = (await res.json()).map(p => ({ ...p, id: p._id }));
        populateFilterOptions();
        renderProducts(products);
      } catch (err) {
        document.getElementById("productsContainer").innerHTML = `<p style="color:red;">Error loading products: ${err.message}</p>`;
      }
    }

    function populateFilterOptions() {
      const categories = new Set(products.map(p => p.category));
      const brands = new Set(products.map(p => p.brand));
      const catSelect = document.getElementById("categoryFilter");
      const brandSelect = document.getElementById("brandFilter");
      categories.forEach(cat => {
        const option = document.createElement("option");
        option.value = cat;
        option.textContent = cat;
        catSelect.appendChild(option);
      });
      brands.forEach(brand => {
        const option = document.createElement("option");
        option.value = brand;
        option.textContent = brand;
        brandSelect.appendChild(option);
      });
    }

    function setupFilters() {
      document.getElementById("searchInput").addEventListener("input", filterAndRender);
      document.getElementById("categoryFilter").addEventListener("change", filterAndRender);
      document.getElementById("brandFilter").addEventListener("change", filterAndRender);
    }

    function filterAndRender() {
      const search = document.getElementById("searchInput").value.toLowerCase();
      const selectedCategory = document.getElementById("categoryFilter").value;
      const selectedBrand = document.getElementById("brandFilter").value;
      const filtered = products.filter(p =>
        (!search || p.name.toLowerCase().includes(search) || p.description.toLowerCase().includes(search)) &&
        (!selectedCategory || p.category === selectedCategory) &&
        (!selectedBrand || p.brand === selectedBrand)
      );
      renderProducts(filtered);
    }

    function renderProducts(list) {
      const container = document.getElementById("productsContainer");
      container.innerHTML = list.length ? "" : "<p>No products found.</p>";
      list.forEach(product => {
        const imageUrl = product.images?.[0] || "https://via.placeholder.com/200x150?text=No+Image";
        const card = document.createElement("div");
        card.className = "product-card";
        card.innerHTML = `
          <img src="${imageUrl}" alt="${product.name}">
          <h3>${product.name}</h3>
          <p>${product.description}</p>
          <span>Price: Ksh ${product.price}</span>
          <span>Quantity: ${product.quantity}</span>
          <div style="margin-top:10px;">
            <button onclick="addToCart('${product.id}')" class="kat">Add to Cart</button>
            <button onclick="toggleFavorite('${product.id}')" class="hat">‚ù§Ô∏è</button>
            <button onclick="window.location.href='product.html?id=${product.id}'" class="viuu">View Product</button>
          </div>
        `;
        container.appendChild(card);
      });
    }
  </script>
</body>
</html>
